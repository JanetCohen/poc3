<!doctype html>
<html>
<body>
<script>
(function () {

    function spray() {
        let bufs = [];
        for (let i = 0; i < 200; i++) {
            bufs.push(new ArrayBuffer(0x1000));
        }
        return bufs;
    }

    function runOnce() {
        // 1. Heap pressure
        let sprayBufs = spray();

        // 2. Target buffer
        let buf = new ArrayBuffer(0x800);
        let u8  = new Uint8Array(buf);
        let f64 = new Float64Array(buf);

        // 3. Isi
        for (let i = 0; i < u8.length; i++) {
            u8[i] = i & 0xff;
        }

        // 4. Drop reference (lifetime stress)
        buf = null;

        // 5. Force pressure (GC heuristic)
        sprayBufs.push(new ArrayBuffer(0x2000));

        // 6. Akses view lama
        let x = f64[1];

        // 7. Observasi anomali
        if (!Number.isFinite(x)) {
            console.log("Weird value:", x);
        }
    }

    // 8. Loop panas
    for (let i = 0; i < 30000; i++) {
        runOnce();
    }

    console.log("done");

})();
</script>
</body>
</html>
